# https://taskfile.dev/#6/installation
version: 3

includes:
  windows: ./Taskfile_windows.yml

tasks:
  build:
    - cmake ./test_minimal -B ./test_minimal/build -DCMAKE_BUILD_TYPE:STRING=Debug -G '{{.CMAKE_GENERATOR | default "Ninja Multi-Config"}}' {{.CMAKE_ARGS}}
    - cmake --build ./test_minimal/build --config Debug

  build:mingw:
    cmds:
      - task: build
        vars:
          CMAKE_ARGS: -DENABLE_CROSS_COMPILING:BOOL=ON -DCMAKE_C_COMPILER={{.CROSS_CC | default "x86_64-w64-mingw32-gcc"}} -DCMAKE_CXX_COMPILER={{.CROSS_CXX | default "x86_64-w64-mingw32-g++"}}

  build:mingw:from-env:
    env: 
      CC: x86_64-w64-mingw32-gcc
      CXX: x86_64-w64-mingw32-g++
    cmds:
      - task: build
        vars:
          CMAKE_ARGS: -DENABLE_CROSS_COMPILING:BOOL=ON

  build:mingw:from-triplet:
    cmds:
      - task: build
        vars:
          CMAKE_ARGS: -DENABLE_CROSS_COMPILING:BOOL=ON -DDEFAULT_TRIPLET=x64-mingw-dynamic

  lint:
    - ~/vcpkg/vcpkg format-manifest ./vcpkg.json